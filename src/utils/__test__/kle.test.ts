import { assertArrayEquality } from "./utils";
import { convert, parse } from "../kle";
import { KeyElement } from "../../components/Key/Key";

const ansi60Kle = [
    ["~\n`","!\n1","@\n2","#\n3","$\n4","%\n5","^\n6","&\n7","*\n8","(\n9",")\n0","_\n-","+\n=",{w:2},"Backspace"],
    [{w:1.5},"Tab","Q","W","E","R","T","Y","U","I","O","P","{\n[","}\n]",{w:1.5},"|\n\\"],
    [{w:1.75},"Caps Lock","A","S","D","F","G","H","J","K","L",":\n;","\"\n'",{w:2.25},"Enter"],
    [{w:2.25},"Shift","Z","X","C","V","B","N","M","<\n,",">\n.","?\n/",{w:2.75},"Shift"],
    [{w:1.25},"Ctrl",{w:1.25},"Win",{w:1.25},"Alt",{a:7,w:6.25},"",{a:4,w:1.25},"Alt",{w:1.25},"Win",{w:1.25},"Menu",{w:1.25},"Ctrl"]
];

const iso60Kle = [
    ["¬\n`","!\n1","\"\n2","£\n3","$\n4","%\n5","^\n6","&\n7","*\n8","(\n9",")\n0","_\n-","+\n=",{w:2},"Backspace"],
    [{w:1.5},"Tab","Q","W","E","R","T","Y","U","I","O","P","{\n[","}\n]",{x:0.25,w:1.25,h:2,w2:1.5,h2:1,x2:-0.25},"Enter"],
    [{w:1.75},"Caps Lock","A","S","D","F","G","H","J","K","L",":\n;","@\n'","~\n#"],
    [{w:1.25},"Shift","|\n\\","Z","X","C","V","B","N","M","<\n,",">\n.","?\n/",{w:2.75},"Shift"],
    [{w:1.25},"Ctrl",{w:1.25},"Win",{w:1.25},"Alt",{a:7,w:6.25},"",{a:4,w:1.25},"AltGr",{w:1.25},"Win",{w:1.25},"Menu",{w:1.25},"Ctrl"]  
];

const stressTestKle = [
    [{a:7},"",{w:1.25,h:1.5},""],
    [""],
    [""],
    [{y:-0.5,x:2,w:2.5},""],
    [{y:-0.5},"",""],
    [{w:1.5},""],
    [{y:-0.75,x:1.5,w:3},""],
    [{y:-0.25,w:1.5},""],
    [""],
    [{r:30,y:-5,x:1,w:2.5},""],
    [{r:45,rx:0.5,ry:0.5,y:-0.5,x:-0.5,a:4},"1"],
    [{r:-15,rx:2.25,ry:2.25,y:-0.75,a:7,w:4.75},"",""]  
]


describe("Deserializes KLE json", () => {
    test("Converts a 60% KLE to a list of key elements", () => {
        const ansi60KeyElements =  [{"position":{"x":0,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["~",undefined,undefined],[undefined,undefined,undefined],["`",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["!",undefined,undefined],[undefined,undefined,undefined],["1",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["@",undefined,undefined],[undefined,undefined,undefined],["2",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["#",undefined,undefined],[undefined,undefined,undefined],["3",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["$",undefined,undefined],[undefined,undefined,undefined],["4",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["%",undefined,undefined],[undefined,undefined,undefined],["5",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["^",undefined,undefined],[undefined,undefined,undefined],["6",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["&",undefined,undefined],[undefined,undefined,undefined],["7",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["*",undefined,undefined],[undefined,undefined,undefined],["8",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["(",undefined,undefined],[undefined,undefined,undefined],["9",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[")",undefined,undefined],[undefined,undefined,undefined],["0",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["_",undefined,undefined],[undefined,undefined,undefined],["-",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["+",undefined,undefined],[undefined,undefined,undefined],["=",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2,"height":1},"content":{"text":[["Backspace",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[["Tab",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Q",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["W",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["E",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["R",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["T",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Y",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["U",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["I",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["O",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["P",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["{",undefined,undefined],[undefined,undefined,undefined],["[",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["}",undefined,undefined],[undefined,undefined,undefined],["]",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[["|",undefined,undefined],[undefined,undefined,undefined],["\\",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.75,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.75,"height":1},"content":{"text":[["Caps Lock",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["A",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["S",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["D",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["F",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["G",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["H",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["J",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["K",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["L",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[":",undefined,undefined],[undefined,undefined,undefined],[";",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["\"",undefined,undefined],[undefined,undefined,undefined],["'",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.25,"height":1},"content":{"text":[["Enter",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.25,"height":1},"content":{"text":[["Shift",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Z",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["X",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["C",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["V",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["B",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["N",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["M",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["<",undefined,undefined],[undefined,undefined,undefined],[",",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[">",undefined,undefined],[undefined,undefined,undefined],[".",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["?",undefined,undefined],[undefined,undefined,undefined],["/",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2.75,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.75,"height":1},"content":{"text":[["Shift",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Ctrl",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.25,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Win",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.5,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Alt",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.75,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":6.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":6.25,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Alt",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.25,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Win",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.5,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Menu",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13.75,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Ctrl",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}}];

        assertArrayEquality(parse(ansi60Kle), ansi60KeyElements);
    });

    test("Converts a 60% ISO KLE to a list of key elements", () => {
        const iso60KeyElements = [{"position":{"x":0,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["¬",undefined,undefined],[undefined,undefined,undefined],["`",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["!",undefined,undefined],[undefined,undefined,undefined],["1",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["\"",undefined,undefined],[undefined,undefined,undefined],["2",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["£",undefined,undefined],[undefined,undefined,undefined],["3",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["$",undefined,undefined],[undefined,undefined,undefined],["4",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["%",undefined,undefined],[undefined,undefined,undefined],["5",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["^",undefined,undefined],[undefined,undefined,undefined],["6",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["&",undefined,undefined],[undefined,undefined,undefined],["7",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["*",undefined,undefined],[undefined,undefined,undefined],["8",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["(",undefined,undefined],[undefined,undefined,undefined],["9",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[")",undefined,undefined],[undefined,undefined,undefined],["0",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["_",undefined,undefined],[undefined,undefined,undefined],["-",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["+",undefined,undefined],[undefined,undefined,undefined],["=",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2,"height":1},"content":{"text":[["Backspace",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[["Tab",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Q",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["W",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["E",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["R",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["T",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Y",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["U",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["I",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["O",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["P",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["{",undefined,undefined],[undefined,undefined,undefined],["[",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.5,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["}",undefined,undefined],[undefined,undefined,undefined],["]",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13.75,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":2},"dimension2Offset":{"x":-0.25,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[["Enter",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.75,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.75,"height":1},"content":{"text":[["Caps Lock",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["A",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["S",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["D",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["F",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["G",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["H",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["J",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["K",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["L",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[":",undefined,undefined],[undefined,undefined,undefined],[";",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["@",undefined,undefined],[undefined,undefined,undefined],["'",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.75,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["~",undefined,undefined],[undefined,undefined,undefined],["#",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Shift",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["|",undefined,undefined],[undefined,undefined,undefined],["\\",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["Z",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["X",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":4.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["C",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":5.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["V",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":6.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["B",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["N",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":8.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["M",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":9.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["<",undefined,undefined],[undefined,undefined,undefined],[",",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[">",undefined,undefined],[undefined,undefined,undefined],[".",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["?",undefined,undefined],[undefined,undefined,undefined],["/",undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.25,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2.75,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.75,"height":1},"content":{"text":[["Shift",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Ctrl",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.25,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Win",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.5,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Alt",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":3.75,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":6.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":6.25,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":10,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["AltGr",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":11.25,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Win",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":12.5,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Menu",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":13.75,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1},"content":{"text":[["Ctrl",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}}];

        assertArrayEquality(parse(iso60Kle), iso60KeyElements);
    });

    test("Converts a KLE with odd rotations to a list of key elements", () => {
        const stressTestKeyElements = [{"position":{"x":0,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1,"y":0},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.25,"height":1.5},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.25,"height":1.5},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":1},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":2},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2,"y":2.5},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":2.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.5,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1,"y":3},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":4},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1.5,"y":4.25},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":3,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":3,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":5},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1.5,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":6},"rotation":{"degrees":0,"origin":{"x":0,"y":0}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":1,"y":2},"rotation":{"degrees":30,"origin":{"x":0,"y":0}},"dimension":{"width":2.5,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":2.5,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":0,"y":0},"rotation":{"degrees":45,"origin":{"x":0.5,"y":0.5}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[["1",undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":2.25,"y":1.5},"rotation":{"degrees":-15,"origin":{"x":2.25,"y":2.25}},"dimension":{"width":4.75,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":4.75,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}},{"position":{"x":7,"y":1.5},"rotation":{"degrees":-15,"origin":{"x":2.25,"y":2.25}},"dimension":{"width":1,"height":1},"dimension2Offset":{"x":0,"y":0},"dimension2":{"width":1,"height":1},"content":{"text":[[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined],[undefined,undefined,undefined]]}}];

        assertArrayEquality(parse(stressTestKle), stressTestKeyElements);
    });

    test("Deserializes key text in the correct position", () => {
        const kle = [["0\n6\n2\n8\n\n\n3\n5\n1\n4\n7"]];

        const key = parse(kle);
        expect(key[0].content.text[0]).toEqual(["0", "1", "2"]);
        expect(key[0].content.text[1]).toEqual(["3", "4", "5"]);
        expect(key[0].content.text[2]).toEqual(["6", "7", "8"]);
        expect(key[0].content.text[3]).toEqual([undefined, undefined, undefined]);
    })

    test("Deserializes key text in the correct position with frontprint", () => {
        const kle = [[{a:0},"0\n6\n2\n8\n9\n11\n3\n5\n1\n4\n7\n10"]];

        const key = parse(kle);
        expect(key[0].content.text[0]).toEqual(["0", "1", "2"]);
        expect(key[0].content.text[1]).toEqual(["3", "4", "5"]);
        expect(key[0].content.text[2]).toEqual(["6", "7", "8"]);
        expect(key[0].content.text[3]).toEqual(["9", "10", "11"]);
    })
});

describe("Serializes a KLE json", () => {
    test("Serializes key text in the correct position with frontprint and alignment flag", () => {
        const key: KeyElement = {
            position: {
                x: 0,
                y: 0
            },
            rotation: {
                origin: {
                    x: 0,
                    y: 0
                },
                degrees: 0
            },
            dimension: {
                width: 1,
                height: 1
            },
            dimension2Offset: {
                x: 0,
                y: 0
            },
            dimension2: {
                width: 1,
                height: 1
            },
            content: {
                text: [
                    ["0", "1", "2"],
                    ["3", "4", "5"],
                    ["6", "7", "8"],
                    ["9", "10", "11"],
                ]
            }
        }

        const kle = convert([key]);
        expect(kle).toEqual([[{a:0},"0\n6\n2\n8\n9\n11\n3\n5\n1\n4\n7\n10"]]);
    });
});

describe("End to end journey", () => {
    test("Deserializes iso60 kle and back again", () => {
        expect(convert(parse(iso60Kle))).toEqual(iso60Kle);
    });

    test("Deserializes stress test kle and back again", () => {
        expect(convert(parse(stressTestKle))).toEqual(stressTestKle);
    });
});
